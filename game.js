!function t(i,e,s){function o(h,a){if(!e[h]){if(!i[h]){var r="function"==typeof require&&require;if(!a&&r)return r(h,!0);if(n)return n(h,!0);var c=new Error("Cannot find module '"+h+"'");throw c.code="MODULE_NOT_FOUND",c}var l=e[h]={exports:{}};i[h][0].call(l.exports,function(t){var e=i[h][1][t];return o(e?e:t)},l,l.exports,t,i,e,s)}return e[h].exports}for(var n="function"==typeof require&&require,h=0;h<s.length;h++)o(s[h]);return o}({1:[function(t,i,e){var s=function(t,i){if(i=i||{},this.entity=t||{},mh.Base.call(this),this.solid=!0,this.static=!1,this.width=50,this.height=50,this.depth=50,this.maxSpeed=10,this.mass=1,this.invmass=0,this.restitution=.8,this.autoAdd=!0,this.boundaryBehavior=vgp.Boundary.BOUNDARY_BOUNCE,this.collisionID=this.uniqueID,this.collisionGroup=null,this.type=t.type,this.onCollision=new vgp.Signal,vgp.utils.merge(this,i),this.position=t&&t.position?t.position:new THREE.Vector3,this.velocity=t&&t.velocity?t.velocity:new THREE.Vector3,this.accel=t&&t.accel?t.accel:new THREE.Vector3,this.min=new vgp.Vec,this.max=new vgp.Vec,this.half=new vgp.Vec(this.width/2,this.height/2,this.depth/2),game.debug){var e=new THREE.CubeGeometry(this.width,this.height,this.depth),s=new THREE.MeshBasicMaterial({color:8983911,wireframe:!0,shading:THREE.FlatShading});this._debugMesh=new THREE.Mesh(e,s)}this._v=new vgp.Vec,this.setMass(this.mass),this.update(),this.position=mh.kai.expect(t,"position",THREE.Vector3)};s.accessor="body",s.className="BODY_AABB3",s.priority=100,s.prototype={constructor:s,activate:function(){this.active=!0,this.min.copy(this.position).sub(this.half),this.max.copy(this.position).add(this.half),this.autoAdd&&game.world.add(this),game.debug&&mh.kai.view.add(this._debugMesh)},disable:function(){this.velocity.set(),this.accel.set(),this.active=!1,game.world.remove(this),game.debug&&mh.kai.view.remove(this._debugMesh)},setMass:function(t){this.mass=t,t<=0?this.invmass=0:this.invmass=1/t},setEntity:function(t,i){this.position=t.position?t.position:new THREE.Vector3,this.velocity=t.velocity?t.velocity:new THREE.Vector3,this.accel=t.accel?t.accel:new THREE.Vector3,i=i||{},vgp.utils.merge(this,i)},reset:function(){this.setMass(this.mass)},update:function(){if(!this.static){var t=game.world,i=this.accel.length();0!==i&&i>this.maxSpeed&&(this.accel.divideScalar(i),this.accel.multiplyScalar(this.maxSpeed)),this.accel.add(t.gravity),this.entity.jumping&&(this.accel.y-=.6*t.gravity.y),this.velocity.multiplyScalar(t.friction),this.velocity.add(this.accel),this._v.copy(this.velocity).multiplyScalar(t.elapsed),this.position.add(this._v),this.min.copy(this.position).sub(this.half),this.max.copy(this.position).add(this.half),this.min.x<t.min.x?(this.position.x=t.min.x+this.half.x,this.velocity.x=-this.velocity.x*this.restitution):this.max.x>t.max.x&&(this.position.x=t.max.x-this.half.x,this.velocity.x=-this.velocity.x*this.restitution),this.min.z<t.min.z?(this.position.z=t.min.z+this.half.z,this.velocity.z=-this.velocity.z*this.restitution):this.max.z>t.max.z&&(this.position.z=t.max.z-this.half.z,this.velocity.z=-this.velocity.z*this.restitution),game.debug&&this._debugMesh.position.copy(this.position)}},dispose:function(){this.onCollision.dispose(),this.onCollision=null,this.entity=null,this.position=null,this.velocity=null,this.accel=null,this.min=null,this.max=null}},i.exports=s},{}],2:[function(t,i,e){var s=function(t,i){i=i||{},mh.Base.call(this),this.maxForce=10,this.slowingRadius=50,this.pathArriveRadius=50,this.groupID=0,this.flockRadius=160,this.maxCohesion=140,this.minSeparation=70,this.angleJitter=.9,this.targetDistance=20,this.targetRadius=20,mh.util.overwrite(this,i),this.entity=t,this.steeringForce=new THREE.Vector3(mh.util.random(this.maxForce),mh.util.random(this.maxForce)),this.maxSpeed=this.entity.maxSpeed||this.maxForce,t.body&&(this.maxSpeed=t.body.maxSpeed),this._wanderAngle=0,this._currentPathNode=0,this._pathDir=1,this._arrived=!1,this.position=mh.kai.expect(t,"position",THREE.Vector3),this.velocity=mh.kai.expect(t,"velocity",THREE.Vector3)};s.accessor="boid",s.className="BOID",s.priority=95,s.post=!1,s.prototype={constructor:s,activate:function(){this.active=!0,this._currentPathNode=0,this._pathDir=1,this._arrived=!1},disable:function(){this.active=!1},update:function(){this.velocity.x+=this.steeringForce.x,this.velocity.z+=this.steeringForce.z,this.steeringForce.x=0,this.steeringForce.z=0},dispose:function(){this.entity=null,this.steeringForce=null,this.position=null,this.velocity=null}},i.exports=s},{}],3:[function(t,i,e){var s=function(t){mh.Base.call(this),this.state=null,this.stack=[],this.entity=t,this.stateChanged=new mh.Signal,this._activeContext=null,this._activeFunction=null,this._prevFunction=null};s.accessor="stack",s.className="STACK_FSM",s.priority=5,s.post=!1,s.prototype={constructor:s,activate:function(){this.active=!0},disable:function(){this.active=!1,this.reset()},reset:function(){this.stack.length=0,this._prevFunction=null,this._activeFunction=null},pushState:function(t,i){t!==this._activeFunction&&(this.stack.push(t),this._activeContext=i,this.active||this.activate())},popState:function(){this.stack.pop(),this._activeFunction=this.stack.length?this.stack[this.stack.length-1]:null,this._activeFunction||(this.stateChanged.dispatch(this.state,"null"),this._prevFunction=null,this.disable())},update:function(){this._activeFunction=this.stack.length?this.stack[this.stack.length-1]:null,this._activeFunction&&(this._activeFunction!==this._prevFunction&&(this.state=this._activeFunction.name,this.stateChanged.dispatch(this._prevFunction?this._prevFunction.name:"null",this.state),this._prevFunction=this._activeFunction),this._activeFunction.call(this._activeContext))},dispose:function(){this.entity=null,this._activeFunction=null,this._prevFunction=null,this.stack=null,this.stateChanged.dispose(),this.stateChanged=null}},i.exports=s},{}],4:[function(t,i,e){var s=function(t,i){i=i||{},mh.Base.call(this),this.textureUrl=null,this.container=mh.kai.view,this.size=i.size||[3,6,3],this.color=1401481,this.emissive=468276,mh.util.overwrite(this,i),this.entity=t,this._display=null;var e=new THREE.CubeGeometry(this.size[0],this.size[1],this.size[2]),s=new THREE.MeshPhongMaterial({color:i.color||1401481,shading:THREE.FlatShading,map:this.textureUrl?THREE.ImageUtils.loadTexture(this.textureUrl):null});this._display=new THREE.Mesh(e,s),this._display.castShadow=!0,this._display.receiveShadow=!0,this.position=mh.kai.expect(t,"position",THREE.Vector3),this.rotation=mh.kai.expect(t,"rotation",THREE.Vector3)};s.accessor="view",s.className="VIEW_CUBE",s.priority=10,s.prototype={constructor:s,activate:function(){this.active=!0,this.container.add(this._display)},disable:function(){this.active=!1,this.container.remove(this._display)},update:function(){this._display.position.copy(this.position),this._display.rotation.setFromVector3(this.rotation)},dispose:function(){this.disable(),this.entity=null,this.position=null,this._display=null}},i.exports=s},{}],5:[function(t,i,e){var s=t("../global"),o=t("./Minion"),n=function(t,i){i=i||{},mh.Base.call(this),this.size=[3,6,3],this.dynamic=!0,this.type=game.Types.DYNAMIC,this.gameGroup=game.Groups.ALLY,this.runSpeed=60,this.jumpSpeed=200,this.airFriction=.5,this.pad=null,this.position=t.clone(),this.velocity=new THREE.Vector3,mh.kai.addComponent(this,s.Components.VIEW_CUBE,{size:this.size}),mh.kai.addComponent(this,s.Components.BODY_AABB3,{width:this.size[0],height:this.size[1],depth:this.size[2],maxSpeed:20,mass:20}),mh.kai.addComponent(this,s.Components.STACK_FSM),this.body.onCollision.add(this.onCollide,this);var e=this;game.input.onConnect.add(function(t){e.pad=t,t.onDown.add(e.onBtnPress,e)}),game.input.onDisconnect.add(function(t){e.pad=null}),this._jumpCount=0,this._curVel=new THREE.Vector3,this._vec=new THREE.Vector3,this._up=new THREE.Vector3(0,(-1),0),this._originalCamRot=game.cameraRig.orbitOffset};n.prototype={constructor:n,activate:function(){this.view.activate(),this.body.activate(),this.stack.pushState(this.idle,this)},disable:function(){this.view.disable(),this.body.disable(),this.stack.reset()},onBtnPress:function(t,i){switch(t){case mh.XBOX.X:mh.tower.playerCommand.dispatch(s.Commands.DEFEND_ME,this.position);break;case mh.XBOX.Y:var e=new o;e.activate(this.position.x+mh.util.random(3),this.position.y,this.position.z+mh.util.random(3));break;case mh.XBOX.A:!this.jumping&&this.velocity.y>=-14.9&&(this.jumping=!0,this.velocity.multiplyScalar(1.5),this.velocity.y+=this.jumpSpeed,this.body.accel.y+=this.jumpSpeed,this._curVel.x=this.velocity.x,this._curVel.z=this.velocity.z);break;case mh.XBOX.LB:game.cameraRig.targetOrbit-=mh.util.PI;break;case mh.XBOX.RB:game.debug?game.cameraRig.targetOrbit=this._originalCamRot:game.cameraRig.targetOrbit+=mh.util.PI}},onCollide:function(t,i){t.type===game.Types.STATIC&&(this.jumping?(this.jumping=!1,console.log(i.normal.y)):0==i.normal.x&&0==i.normal.z||Math.round(t.position.y+t.half.y-this.position.y-this.body.half.y)===-game.board.tileHeightStep&&(this.position.y+=game.board.tileHeightStep+.1))},idle:function(){this.pad&&(game.cameraRig.update(this.position,game.debug?.05*this.pad.rightAxis.x:0),game.cameraRig.cam.zoom-=.05*this.pad.rightAxis.y,game.cameraRig.cam.updateProjectionMatrix(),this._vec.x=this.pad.leftAxis.x,this._vec.z=this.pad.leftAxis.y,this._vec.applyAxisAngle(this._up,game.cameraRig.orbitOffset+.785398163397),this.jumping?(this.velocity.x=this._curVel.x+this._vec.x*(this.runSpeed*this.airFriction),this.velocity.z=this._curVel.z+this._vec.z*(this.runSpeed*this.airFriction)):(this.velocity.x=this._vec.x*this.runSpeed,this.velocity.z=this._vec.z*this.runSpeed))},dispose:function(){mh.kai.removeComponent(this,s.Components.VIEW_CUBE),mh.kai.removeComponent(this,s.Components.BODY_AABB3),mh.kai.removeComponent(this,s.Components.STACK_FSM),this.position=null,this.velocity=null}},i.exports=n},{"../global":9,"./Minion":6}],6:[function(t,i,e){var s=t("../global"),o=t("../system/steering"),n=function(){mh.Base.call(this),this.size=[2,3,2],this.dynamic=!0,this.type=game.Types.DYNAMIC,this.gameGroup=game.Groups.ALLY,this.maxSpeed=60,this.jumpSpeed=300,this.airFriction=.5,this.path=null,this.position=new THREE.Vector3,this.velocity=new THREE.Vector3,mh.kai.addComponent(this,s.Components.VIEW_CUBE,{size:this.size,color:1360412}),mh.kai.addComponent(this,s.Components.BODY_AABB3,{width:this.size[0],height:this.size[1],depth:this.size[2],maxSpeed:40,mass:1}),mh.kai.addComponent(this,s.Components.BOID,{}),mh.kai.addComponent(this,s.Components.STACK_FSM),mh.tower.playerCommand.add(this.onCommand,this)};n.prototype={constructor:n,activate:function(t,i,e){this.active=!0,this.position.set(t,i,e),this.view.activate(),this.body.activate(),this.boid.activate(),this.stack.pushState(this.idle,this)},disable:function(){this.active=!1,this.view.disable(),this.body.disable(),this.boid.disable(),this.stack.reset()},dispose:function(){mh.kai.removeComponent(this,s.Components.VIEW_CUBE),mh.kai.removeComponent(this,s.Components.BODY_AABB3),mh.kai.removeComponent(this,s.Components.STACK_FSM),this.position=null,this.velocity=null},onCollide:function(t,i){},onCommand:function(t,i){switch(t){case s.Commands.DEFEND_ME:this.path=i}},idle:function(){this.path&&o.seek(this.boid,this.path)},pathingHeuristic:function(t,i){return!(i.h-t.h>10)}},i.exports=n},{"../global":9,"../system/steering":15}],7:[function(t,i,e){var s=function(){if(mh.Base.call(this),this.solid=!0,this.static=!0,this.width=10,this.height=50,this.depth=10,this.maxSpeed=0,this.mass=0,this.invmass=0,this.restitution=.6,this.collisionID=1,this.collisionGroup=null,this.type=game.Types.STATIC,this.position=new THREE.Vector3,this.velocity=new vgp.Vec,this.min=new vgp.Vec,this.max=new vgp.Vec,this.half=new vgp.Vec(this.width/2,this.height/2,this.depth/2),game.debug){var t=new THREE.CubeGeometry(this.width,this.height,this.depth),i=new THREE.MeshBasicMaterial({color:582252,wireframe:!0,shading:THREE.FlatShading});this._debugMesh=new THREE.Mesh(t,i),this.position=this._debugMesh.position}};s.prototype={constructor:s,activate:function(t){var i=t.tile,e=i.position;this.position.x=e.x+this.half.x,this.position.y=e.y-this.half.y,this.position.z=e.z+this.half.z,this.min.copy(this.position).sub(this.half),this.max.copy(this.position).add(this.half),this.active||(this.active=!0,game.debug&&mh.kai.view.add(this._debugMesh))},disable:function(){this.active=!1,game.debug&&mh.kai.view.remove(this._debugMesh)},dispose:function(){this.position=null,this.velocity=null,this.min=null,this.max=null,this.half=null}},i.exports=s},{}],8:[function(t,i,e){var s=new mh.Engine,o=t("./global"),n=t("./system/CameraRig");o.debug=!0;var h=new THREE.HemisphereLight(16777215,16777215,1);h.color.setRGB(.549,.78,1),h.position.set(0,500,0);var a=new THREE.DirectionalLight(16777215,3);a.position.set(10,10,1),mh.kai.view=new vg.Scene({element:document.getElementById("stage"),cameraPosition:{x:-100,y:100,z:100},light:a,cameraType:"OrthographicCamera",orthoZoom:10},(!1)),mh.kai.view.container.add(h),o.cameraRig=new n(mh.kai.view.camera);var r=t("./system/GamepadController");o.input=new r,o.Components=mh.kai.registerComponents([t("./components/THREECube"),t("./components/StackFSM"),t("./components/Boid"),t("./components/AABB3")]);var c="Adventure";s.state.add(c,t("./states/Adventure")),s.start(c)},{"./components/AABB3":1,"./components/Boid":2,"./components/StackFSM":3,"./components/THREECube":4,"./global":9,"./states/Adventure":10,"./system/CameraRig":11,"./system/GamepadController":12}],9:[function(t,i,e){var s={board:null,grid:null,world:null,nextLevel:0,inputBlocked:!1,input:null,cameraRig:null,Components:null,Types:{STATIC:"static",DYNAMIC:"dynamic",FAST:"fast"},Groups:{ENEMY:"enemy",ALLY:"ally"},Commands:{DEFEND_ME:"defend me",DEFEND_CASTLE:"defend our castle",ATTACK:"attack",ATTACK_CASTLE:"attack enemy castle"}};i.exports=s,window.game=s},{}],10:[function(t,i,e){i.exports={create:function(){this.ready=!1,this.grid=new vg.SqrGrid,this.grid.load("./assets/maps/test1.json",this.start,this),game.grid=this.grid,mh.tower.playerCommand=new mh.Signal},start:function(){var i=t("../entities/Box"),e=new vg.Board(this.grid);game.board=e;var s=new vg.GeneratedTileManager(e);s.makeTiles(),mh.kai.view.add(e.group),mh.kai.view.focusOn(e.group);var o=t("../system/World");game.world=new o;var n=new i(new THREE.Vector3((-15),10,(-5)));n.activate(),this.player=n,this.ready=!0},update:function(){this.ready&&(game.input.update(),game.world.update(),mh.kai.view.render())},dispose:function(){game.input.dispose(),game.grid.dispose(),game.world.dispose(),mh.tower.playerCommand.dispose()}}},{"../entities/Box":5,"../system/World":13}],11:[function(t,i,e){var s=function(t){this.pivot=new THREE.Object3D,this.cam=t,this.pivot.add(this.cam),mh.kai.view.add(this.pivot),this.pos=this.pivot.position,this.cam.lookAt(this.pos),this.orbitOffset=0,this.targetOrbit=this.orbitOffset,this._vec=new THREE.Vector3,this.targetPos=new THREE.Vector3,this.deadzone=10,this.halfDeadzone=this.deadzone/2,this.deadzoneY=2};s.prototype={constructor:s,update:function(t,i){this.targetPos.x<t.x-this.deadzone?this.targetPos.x=t.x-this.deadzone:this.targetPos.x>t.x+this.halfDeadzone&&(this.targetPos.x=t.x+this.halfDeadzone),this.targetPos.y<t.y-this.deadzoneY?this.targetPos.y=t.y-this.deadzoneY:this.targetPos.y>t.y+this.deadzoneY&&(this.targetPos.y=t.y+this.deadzoneY),this.targetPos.z<t.z-this.halfDeadzone?this.targetPos.z=t.z-this.halfDeadzone:this.targetPos.z>t.z+this.deadzone&&(this.targetPos.z=t.z+this.deadzone),this.pos.lerp(this.targetPos,.1),this.targetOrbit+=i,this.orbitOffset+=.1*(this.targetOrbit-this.orbitOffset),this.pivot.rotation.y=this.orbitOffset}},i.exports=s},{}],12:[function(t,e,s){var o=function(){var i=t("../system/XboxGamepad");this.controllers=[],this.onConnect=new mh.Signal,this.onDisconnect=new mh.Signal,this.activeControllers=0,this._controllerStatus=[];for(var e=0;e<4;e++)this.controllers[e]=new i(e),this._controllerStatus[e]=!1;window.addEventListener("gamepadconnected",this._onConnect.bind(this),!1),window.addEventListener("gamepaddisconnected",this._onDisconnect.bind(this),!1)};o.prototype={constructor:o,update:function(){var t,i;for(navigator.getGamepads&&this._scan(),t=0;t<4;t++)i=this.controllers[t],i.active&&i.update()},dispose:function(){for(i=0;i<4;i++)this.controllers[i].dispose();this.controllers=null,this.onConnect.dispose(),this.onDisconnect.dispose(),this.onConnect=null,this.onDisconnect=null,this._controllerStatus=null},_addPad:function(t){var i=this.controllers[t.index];i.register(t),this.onConnect.dispatch(i),this.activeControllers++},_removePad:function(t){var i=t.index?this.controllers[t.index]:this.controllers[t];i.unregister(),this.onDisconnect.dispatch(i),this.activeControllers--},_onConnect:function(t){this._addPad(t.gamepad)},_onDisconnect:function(t){this._removePad(t.gamepad)},_scan:function(){var t,i=navigator.getGamepads();for(t=0;t<i.length;t++)i[t]?this._controllerStatus[t]?this.controllers[t].setPad(i[t]):(this._addPad(i[t]),this._controllerStatus[t]=!0):!i[t]&&this._controllerStatus[t]&&(this._removePad(t),this._controllerStatus[t]=!1)}},e.exports=o},{"../system/XboxGamepad":14}],13:[function(t,i,e){var s=function(){var i=t("../entities/TileAABB"),e=game.grid,o=game.board;this.boundingBox=(new THREE.Box3).setFromObject(o.tileGroup),this.tilesPerWorldCell=3;var n=e.cellSize*this.tilesPerWorldCell;if(this.worldCellSize=n,s.PX_TO_GRID=1/n,this.active=!0,this.bounded=!0,this.friction=.8,this.gravity=new THREE.Vector3(0,(-1),0),this.elapsed=.0166,this.broadphaseGrid=[],this.min=this.boundingBox.min,this.max=this.boundingBox.max,this.objects=new vgp.LinkedList,this._listPool=new vgp.ObjectPool(vgp.LinkedList,null,20),this._tilePool=new mh.DualPool(i,null,this.tilesPerWorldCell*this.tilesPerWorldCell*2),this._emptyCell=new vgp.LinkedList,this._tileSize=e.cellSize,this._vec=new THREE.Vector3,game.debug){var h=new THREE.BoxHelper(o.tileGroup,16776960);mh.kai.view.add(h)}};s.PX_TO_GRID=0,s.prototype={constructor:s,add:function(t){return t=t.body||t,t.collisionID?void this.objects.add(t):(console.warn("[vgp.World.add] Ignoring object; must be an entity or physics component"),void console.dir(t))},remove:function(t){t=t.body||t,this.objects.remove(t)},update:function(){var t,i,e,o,n,h,a,r,c,r,l,d,p,u,m,v;for(e=this._listPool.busy.first;e;)i=e.obj,e=e.next,i.clear(),i.active=!1;this._tilePool.freeAll(),this._vec.y=0;for(e=this.objects.first;e;)if(i=e.obj,e=e.next,i.solid&&i.active)for(c=Math.floor(i.min.x*s.PX_TO_GRID),cXEntityMax=Math.floor(i.max.x*s.PX_TO_GRID),a=Math.floor(i.min.z*s.PX_TO_GRID),r=Math.floor(i.max.z*s.PX_TO_GRID),p=a;p<=r;p++)for(m=this.broadphaseGrid[p],m||(m=[],this.broadphaseGrid[p]=m),u=c;u<=cXEntityMax;u++){for(v=m[u],v||(v=this._listPool.get(),v.active=!1,m[u]=v),v.active||(v.active=!0,l=u*this.worldCellSize,d=p*this.worldCellSize,this._vec.x=l,this._vec.z=d,h=game.grid.getCellAt(this._vec),h&&(block=this._tilePool.get(),block.activate(h),v.add(block)),this._vec.x=l+this._tileSize,this._vec.z=d,h=game.grid.getCellAt(this._vec),h&&(block=this._tilePool.get(),block.activate(h),v.add(block)),this._vec.x=l+this._tileSize+this._tileSize,this._vec.z=d,h=game.grid.getCellAt(this._vec),h&&(block=this._tilePool.get(),block.activate(h),v.add(block)),this._vec.x=l,this._vec.z=d+this._tileSize,h=game.grid.getCellAt(this._vec),h&&(block=this._tilePool.get(),block.activate(h),v.add(block)),this._vec.x=l+this._tileSize,this._vec.z=d+this._tileSize,h=game.grid.getCellAt(this._vec),h&&(block=this._tilePool.get(),block.activate(h),v.add(block)),this._vec.x=l+this._tileSize+this._tileSize,this._vec.z=d+this._tileSize,h=game.grid.getCellAt(this._vec),h&&(block=this._tilePool.get(),block.activate(h),v.add(block)),this._vec.x=l,this._vec.z=d+this._tileSize+this._tileSize,h=game.grid.getCellAt(this._vec),h&&(block=this._tilePool.get(),block.activate(h),v.add(block)),this._vec.x=l+this._tileSize,this._vec.z=d+this._tileSize+this._tileSize,h=game.grid.getCellAt(this._vec),h&&(block=this._tilePool.get(),block.activate(h),v.add(block)),this._vec.x=l+this._tileSize+this._tileSize,this._vec.z=d+this._tileSize+this._tileSize,h=game.grid.getCellAt(this._vec),h&&(block=this._tilePool.get(),block.activate(h),v.add(block))),n=v.first;n;)o=n.obj,n=n.next,o.collisionID!==i.collisionID&&(t=vgp.physics.separateAABB3AABB3(i,o),t&&(vgp.physics.resolve(i,o,t),i.onCollision&&i.onCollision.dispatch(o,t),o.onCollision&&o.onCollision.dispatch(i,t)));v.add(i)}},getCell:function(t,i){return t=Math.floor(t*s.PX_TO_GRID),i=Math.floor(i*s.PX_TO_GRID),this.broadphaseGrid[t]&&this.broadphaseGrid[t][i]&&this._listPool.busy.has(this.broadphaseGrid[t][i])?this.broadphaseGrid[t][i]:this._emptyCell},getCells:function(t,i,e,o,n){var h,a,r,c,l,d,p=s.PX_TO_GRID;for(t=Math.floor(t*p),i=Math.floor(i*p),r=t+Math.floor(e*p),c=i+Math.floor(o*p),h=t;h<=r;h++)if(this.broadphaseGrid[h])for(l=this.broadphaseGrid[h],a=i;a<=c;a++)l[a]&&(d=this.broadphaseGrid[h][a],this._listPool.busy.has(d)&&n.push(d));return n},disable:function(){this.active=!1},dispose:function(){this.objects.dispose(),this.objects=null,this.broadphaseGrid=null,this.min=null,this.max=null,this._emptyCell=null}},i.exports=s},{"../entities/TileAABB":7}],14:[function(t,i,e){var s=function(t){mh.Base.call(this),this.id=t,this.onDown=new mh.Signal,this.onUp=new mh.Signal,this.leftAxis=new THREE.Vector2,this.rightAxis=new THREE.Vector2,this.leftTrigger=0,this.rightTrigger=0,this.axisTolerance=.2,this.controller=null,this.buttons=null,this._numButtons=0,this._prevButtons=[]};s.prototype={constructor:s,register:function(t){this.setPad(t),this._numButtons=this.buttons.length,this.activate(),console.log("[XboxGamepad.register] CONNECTED "+this.id)},unregister:function(){this.disable(),this.controller=null,this.buttons=null,this._numButtons=0,console.log("[XboxGamepad.unregister] DISCONNECTED "+this.id)},setPad:function(t){this.controller=t,this.buttons=t.buttons},update:function(){var t,i,e=this.controller.axes[0],s=this.controller.axes[1],o=this.controller.axes[2],n=this.controller.axes[3];for(e<this.axisTolerance&&e>-this.axisTolerance&&(e=0),s<this.axisTolerance&&s>-this.axisTolerance&&(s=0),o<this.axisTolerance&&o>-this.axisTolerance&&(o=0),n<this.axisTolerance&&n>-this.axisTolerance&&(n=0),this.leftAxis.x=e,this.leftAxis.y=s,this.rightAxis.x=o,this.rightAxis.y=n,t=0;t<this._numButtons;t++)i=this.buttons[t],6===t?this.leftTrigger=i.value||i:7===t&&(this.rightTrigger=i.value||i),i.pressed&&!this._prevButtons[t]?this.onDown.dispatch(t,i):!i.pressed&&this._prevButtons[t]&&this.onUp.dispatch(t,i),this._prevButtons[t]=i.pressed},isDown:function(t){return!(mh.kai.inputBlocked||!this.active)&&!!this.buttons[t]},activate:function(){this.active=!0,this.leftAxis.x=0,this.leftAxis.y=0,this.rightAxis.x=0,this.rightAxis.y=0,this.leftTrigger=0,this.rightTrigger=0;for(var t=0;t<this._numButtons;t++)this.buttons[t]=0,this._prevButtons[t]=0},disable:function(){this.active=!1,this.onDown.removeAll(),this.onUp.removeAll()},dispose:function(){this.onDown.dispose(),this.onUp.dispose(),this.onDown=null,this.onUp=null}},mh.XBOX={A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,SELECT:8,START:9,LSTICK:10,RSTICK:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},i.exports=s},{}],15:[function(t,i,e){i.exports={_sumForce:new THREE.Vector3,_desiredVec:new THREE.Vector3,_scratchVec:new THREE.Vector3,_wanderVec:new THREE.Vector3,_seperationForce:new THREE.Vector3,_cohereForce:new THREE.Vector3,_alignForce:new THREE.Vector3,_wanderAngle:0,seek:function(t,i,e){var s=t.position.distanceTo(i);return e=e||0,s<7?void t.velocity.multiplyScalar(.9):(this._desiredVec.copy(i).sub(t.position),this._desiredVec.normalize(),s<e?(this._desiredVec.multiplyScalar(t.maxForce*(s/e)),t.velocity.multiplyScalar(.9)):this._desiredVec.multiplyScalar(t.maxForce),void t.steeringForce.add(this._desiredVec))},flee:function(t,i){this._desiredVec.copy(t.position).sub(i),this._desiredVec.normalize().multiplyScalar(t.maxForce),t.steeringForce.add(this._desiredVec)},align:function(t,i){var e,s,o=0,n=i.first;for(this._alignForce.x=0,this._alignForce.z=0;n;)e=n.obj.entity.boid,e.groupID===t.groupID?(s=t.position.distanceTo(e.position),s<t.maxCohesion&&e.velocity.getLength()>0&&(this._scratchVec.copy(e.velocity),this._scratchVec.normalize(),this._alignForce.add(this._scratchVec),e._arrived&&(t._arrived=!0),o++),n=n.next):n=n.next;return 0===o?this._alignForce:(this._alignForce.divideScalar(o),this._alignForce.multiplyScalar(t.maxForce),this._alignForce)},cohere:function(t,i){var e,s,o=0,n=i.first;for(this._sumForce.x=0,this._sumForce.z=0;n;)e=n.obj.entity.boid,e!==t&&e.groupID===t.groupID&&(s=t.position.distanceTo(e.position),s<t.maxCohesion&&(this._sumForce.add(e.position),e._arrived&&(t._arrived=!0),o++)),n=n.next;return 0===o?(this._cohereForce.x=0,void(this._cohereForce.z=0)):(this._sumForce.divideScalar(o),this._cohereForce.copy(this._sumForce).sub(t.position),this._cohereForce.normalize().multiplyScalar(t.maxForce),this._cohereForce)},separate:function(t,i){var e=0,s=i.first;for(this._seperationForce.x=0,this._seperationForce.z=0;s;){var o=s.obj.entity.boid;if(o!==t){var n=t.position.distanceTo(o.position);if(n<t.minSeparation&&n>0){this._scratchVec.copy(o.position).sub(t.position);var h=this._scratchVec.getLength(),a=t.minSeparation+o.minSeparation;this._scratchVec.multiplyScalar(1-(h-a)/(t.minSeparation-a)),this._seperationForce.x+=this._scratchVec.x,this._seperationForce.z+=this._scratchVec.z,e++}}s=s.next}return 0===e?this._seperationForce:(this._seperationForce.multiplyScalar(t.maxForce/e),this._seperationForce)},wander:function(t){this._desiredVec.copy(t.velocity),this._desiredVec.normalize(),this._desiredVec.multiplyScalar(t.targetDistance),this._scratchVec.reset(0,-1),this._scratchVec.multiplyScalar(t.targetRadius),this._scratchVec.setAngle(t._wanderAngle),t._wanderAngle+=Math.random()*t.angleJitter-.5*t.angleJitter,this._desiredVec.add(this._scratchVec),t.steeringForce.add(this._desiredVec)},flock:function(t,i){this.separate(t,i),this.align(t,i),this.cohere(t,i),this._seperationForce.multiplyScalar(.2),this._alignForce.multiplyScalar(1.3),this._cohereForce.multiplyScalar(.6),t.steeringForce.x+=this._seperationForce.x+this._alignForce.x+this._cohereForce.x,t.steeringForce.z+=this._seperationForce.z+this._alignForce.z+this._cohereForce.z},followPath:function(t,i,e){var s=i[t._currentPathNode];return s?((t._arrived||t.position.distanceTo(s)<=t.pathArriveRadius)&&(t._currentPathNode+=t._pathDir,t._arrived=!1,(t._currentPathNode>=i.length||t._currentPathNode<0)&&(e?(t._pathDir*=-1,t._currentPathNode+=t._pathDir):(t._currentPathNode=i.length-1,s=i[t._currentPathNode],t._arrived=!0))),void this.seek(t,s,t.slowingRadius)):(t._arrived=!0,void(t._currentPathNode=0))},pursue:function(t,i){this._scratchVec.copy(i.position).add(i.velocity),this._scratchVec.multiplyScalar(t.distanceTo(i)/t.maxForce),this.seek(t,this._scratchVec)},evade:function(t,i){this._scratchVec.copy(i.position).add(i.velocity),this._scratchVec.multiplyScalar(t.distanceTo(i)/t.maxForce),this.flee(t,this._scratchVec)}}},{}]},{},[8]);
//# sourceMappingURL=game.js.map
